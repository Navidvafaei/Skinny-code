%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


sbox_hex= { 'c' '6' '9' '0' '1' 'a' '2' 'b' '3' '8' '5' 'd' '4' 'e' '7' 'f'};
const_hex={ '01' '03' '07' '0f' '1f' '3e' '3d' '3b' '37' '2f' '1e' '3c' '39' '33' '27' '0e'...
            '1d' '3a' '35' '2b' '16' '2c' '18' '30' '21' '02' '05' '0b' '17' '2e' '1c' '38'...
            '31' '23' '06' '0d' '1b' '36' '2d' '1a' '34' '29' '12' '24' '08' '11' '22' '04'...
            '09' '13' '26' '0c' '19' '32' '25' '0a' '15' '2a' '14' '28' '10' '20'};
%const_matrix=zeros(4,4);
sbox=hex2dec(sbox_hex);
PT=[9,15,8,13,10,14,12,11,0,1,2,3,4,5,6,7];


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%palintext_hex= { '0' '0' '0' '0' '0' '0' '0' '0' '0' '0' '0' '0' '0' '0' '0' '0'};
%c=hex2dec(plaintext_hex);
 %f=reshape(c,4,4);
 %plaintext=zeros(4,4);
 %k=zeros(4,4);
 
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


 clc
 %plaintext_hex= { '1' '2' '3' '4' '5' '6' '7' '8' '9' 'a' 'b' 'c' 'd' 'e' 'f' '0'};
 plaintext_hex= { '0' '6' '0' '3' '4' 'f' '9' '5' '7' '7' '2' '4' 'd' '1' '9' 'd'};
 plaintext=hex2dec(plaintext_hex);
 %key_hex= { '2' '3' '4' '5' '6' '7' '8' '9' 'a' 'b' 'c' 'd' 'e' 'f' '0' '1' };
 key_hex= { 'f' '5' '2' '6' '9' '8' '2' '6' 'f' 'c' '6' '8' '1' '2' '3' '8' };
 key=hex2dec(key_hex);
 Mc=zeros(4,4);
 k=zeros(33,4,4,4,4);
 %f=zeros(4,4);
 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


 
 
 

            for round=1:32
                
                
            %p
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             
             
             
             plaintext(1:16,1)=sbox(plaintext(1:16,1)+1,1);
                      
                          
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             
             plaintext=reshape(plaintext,4,4)';
             
             
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

             
             c=dec2bin(hex2dec(const_hex(1,p)),8);
             c0=bin2dec(c(1,5:8));
             c1=bin2dec(c(1,1:4));   
             c2=hex2dec('02');
             const_matrix=zeros(4,4);
             const_matrix(1,1)=const_matrix(1,1)+c0;
             const_matrix(2,1)=const_matrix(2,1)+c1;
             const_matrix(3,1)=const_matrix(3,1)+c2;
             plaintext(1:3,1)=bitxor(plaintext(1:3,1),const_matrix(1:3,1));
             
             
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             
             key1=reshape(key,4,4);
             key=reshape(key,4,4)';
             plaintext(1:2,1:4)=bitxor(plaintext(1:2,1:4),key(1:2,1:4));
             key=reshape(key1,16,1);
             key(1:16,1)=key(PT(1,1:16)+1,1);
             %dec2hex(key);


                     
             %
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             
             
             plaintext=cycle(plaintext,'right');
             
             
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             
             
             
             Mc(4,:)=bitxor(plaintext(1,:),plaintext(3,:));
             Mc(3,:)=bitxor(plaintext(2,:),plaintext(3,:));
             Mc(2,:)=plaintext(1,:);
             Mc(1,:)=bitxor(Mc(4,:),plaintext(4,:));
             plaintext=Mc;
             
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
             
             plaintext=reshape(plaintext,4,4)';
             plaintext=reshape(plaintext,16,1);
             final=dec2hex(plaintext);

            end

 
